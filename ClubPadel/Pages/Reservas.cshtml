@page "{nombre?}/{idCli?}"
@model ClubPadel.Pages.ReservasModel
@{
    ViewData["Title"] = "Reservas";
}

<link rel="stylesheet" type="text/css" href="~/css/Reservas.css">

<div class="container row" id="titulo">
    <div class="col-6">
        <h2 class="text-info">Reservas Pistas</h2>
        <h2 class="text-info" name="usuario">:)</h2>
    </div>
    <br />
</div>
<br />
<div>
    <left>
        <div>
            <p>INTRODUCIR EL NOMBRE DEL USUARIO!!</p>
        </div>
        <div class="col-sm-2">
            <a asp-page="Index" style="background-color:brown; width:120px" class="btn btn-success form-control">Cerrar sesión</a>
        </div>
    </left>
</div>
<br />
<div class="4" id="fechaPadre">
    <input id="fecha" type="date"
           min="0-0-0"
           max="0-0-0" />
    <input id="button" type="button" onclick="buscarHoras()" value="Buscar Horas" />
</div>
<br />
<div class="row text-center" id="cuadroTexto">
    <div class="alert alert-info text-center invisible" style="width: 100%" id="alerta">
        <p id="mensaje"></p>
        <a class="btn btn-success" id="btnAceptar1">Aceptar</a>
        <a class="btn btn-success invisible" id="btnAceptar2" onclick="hacerInvisible()">Aceptar</a>
        <a class="btn btn-success invisible" id="btnAceptar3">Aceptar</a>
        <a class="btn btn-danger invisible" id="btnCancelar3" onclick="hacerInvisible()">Cancelar</a>
        <a class="btn btn-danger invisible" id="btnCancelar2" onclick="hacerVisible()">Cancelar</a>
        <a class="btn btn-danger" id="btnCancelar1" onclick="cambiarSalirSinReservar()">Cancelar</a>
    </div>
</div>
<br />


@*Steven*@
<form method="post">
    <table class="table table-striped border">
        <tr id="nombres" class="table-secondary">
            <th>Id</th>
            <th>Estado</th>
            <th>Nombre</th>
            <th>Acción</th>
        </tr>
        @{ string url = ViewContext.RouteData.Values["IdCli"].ToString();}
        @foreach (var item in Model.Reservas)
        {
            <tr class="text-white">
                <td>@Html.DisplayFor(m => item.Id)</td>
                <td>@Html.DisplayFor(m => item.Hora)</td>
                <td>@Html.DisplayFor(m => item.Fecha)</td>
                <td>
                    @if (item.IdCliente == null)
                    {
                        @*<input class="btn btn-success" value="Reservar" onclick="document.getElementById(@item.Id).style.display='block'" />*@
                        <input class="btn btn-success" type="submit" value="Reservar" asp-route-id="idCliente" asp-page-handler="Cambio"/>
                    }
                    else if (item.IdCliente == int.Parse(url))
                    {
                        <input class="btn btn-danger" type="submit" value="Cancelar" asp-route-id="@item.Id" asp-page-handler="Cambio" />
                    }
                    else
                    {
                        <input class="btn btn-dark disabled" type="submit" value="Ocupado" asp-route-id="@item.Id" asp-page-handler="Cambio" />
                    }

                </td>
            </tr>
        }
    </table>
    <br />
    <br />
</form>

<button onclick="verModelAceptar()">Open Modal</button>

<div id="modelAceptar" class="modal">
    <span onclick="cerrarModelAceptar()" class="close" title="Close Modal">×</span>
    <form class="modal-content" action="/action_page.php">
        <div class="container">
            <h1>Delete Account</h1>
            <p>Are you sure you want to delete your account?</p>

            <div class="clearfix">
                <button type="button" onclick="cerrarModelAceptar()" class="cancelbtn">Cancel</button>
                <button type="button" onclick="cerrarModelAceptar()" class="deletebtn">Delete</button>
            </div>
        </div>
    </form>
</div>


<div id="horas" style="padding: 4px;
            width: 100%;
            height: 550px;
            overflow: auto;">
</div>
<br />






<script>
    var idCliente = 1;

    function verModelAceptar() {
        document.getElementById('modelAceptar').style.display = 'block';
    }

    function cerrarModelAceptar() {
        document.getElementById('modelAceptar').style.display = 'none';
    }

    function getIdCliente() {
        return idCliente;
    }

    function setIdCliente(id) {
        idCliente = id;
    }

    // Get the modal
    var modal = document.getElementById('id01');

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    // Formato de la fecha actual

    function fechaActual() {
        let date = new Date();
        let year = date.getFullYear().toString();
        let day = date.getDate().toString();
        let month = date.getMonth() + 1;
        if (month < 9) {
            if (day < 9) {
                return year + "-0" + month.toString() + "-0" + day;
            } else {
                return year + "-0" + month.toString() + "-" + day;
            }
        } else {
            if (day < 9) {
                return year + "-" + month.toString() + "-0" + day;
            } else {
                return year + "-" + month.toString() + "-" + day;
            }
        }
    }
    document.getElementById("fecha").value = fechaActual();

    function fechaLimite() {
        var date = new Date();
        var day = date.getDate() + 1;
        var month = date.getMonth() + 1;
        var year = date.getFullYear().toString();
        if (month < 9) {
            if (day < 9) {
                return year + "-0" + month.toString() + "-0" + day;
            } else {
                return year + "-0" + month.toString() + "-" + day;
            }
        } else {
            if (day < 9) {
                return year + "-" + month.toString() + "-0" + day;
            } else {
                return year + "-" + month.toString() + "-" + day;
            }
        }
    }
    document.getElementById("fecha").setAttribute("max", fechaLimite());
    document.getElementById("fecha").setAttribute("min", fechaActual());

    // ------------------------------------------------------------------------------
    function buscarHoras() {
        let valor = document.getElementById("fecha").value;
        let msValor = Date.parse(valor);
        let fechaValor = new Date(msValor);

        let ms1 = Date.parse(fechaActual());
        let fecha1 = new Date(ms1);

        if (fechaValor.getTime() == fecha1.getTime()) {
            location.href = "/ReservasPistaA";
        } else {
            location.href = "/ReservaPistaB";
        }
    }
</script>